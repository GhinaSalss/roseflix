<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Purchase History | RoseFlix</title>
    <link rel="icon" type="image/png" href="/assets/icon-192.png" />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#ec4899" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Outfit", sans-serif;
        background: #0b020c;
        color: white;
      }
      .glass {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
    </style>
  </head>
  <body class="min-h-screen pb-32 focus:bg-pink-500">
    <header class="p-8">
      <h1 class="text-3xl font-black">History</h1>
      <p class="text-gray-500 text-sm font-medium">Unlocked premium content</p>
    </header>

    <div id="history-container" class="px-8 space-y-4">
      <!-- History items -->
    </div>

    <script type="module">
      import storage from "./js/storage.js"
      import Navbar from "./components/navbar.js"
      import { IMAGE_BASE_URL } from "./js/api.js"

      const container = document.getElementById("history-container")

      function init() {
        Navbar.render("history")
        renderHistory()
      }

      function renderHistory() {
        const list = storage.getHistory()
        if (list.length === 0) {
          container.innerHTML =
            '<div class="py-40 text-center text-gray-600 font-medium whitespace-pre-line text-lg">No purchases yet.\nUnlock your first trailer!</div>'
          return
        }

        container.innerHTML = list
          .map(
            (item) => `
                <div class="glass p-4 rounded-[2rem] flex gap-4 items-center group active:scale-95 transition-all" onclick="location.href='detail.html?id=${item.id}'">
                    <img src="${IMAGE_BASE_URL}${item.poster_path}" class="w-16 h-24 object-cover rounded-2xl shadow-lg" alt="${item.title}">
                    <div class="flex-grow">
                        <p class="text-[10px] font-black text-pink-500 uppercase tracking-widest mb-1">${item.invoice}</p>
                        <h4 class="text-sm font-bold white mb-1">${item.title}</h4>
                        <div class="flex items-center gap-3">
                            <span class="text-[10px] text-gray-500 font-medium"><i class="far fa-calendar-alt mr-1"></i> ${item.date}</span>
                            <span class="text-[10px] text-gray-500 font-medium"><i class="fas fa-wallet mr-1"></i> ${item.paymentMethod}</span>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-sm font-black text-white">${item.price}</p>
                        <span class="text-[8px] px-2 py-1 rounded bg-emerald-500/20 text-emerald-400 font-bold uppercase">Success</span>
                    </div>
                </div>
            `,
          )
          .join("")
      }

      init()
    </script>
    <script src="js/pwa.js"></script>
  </body>
</html>
